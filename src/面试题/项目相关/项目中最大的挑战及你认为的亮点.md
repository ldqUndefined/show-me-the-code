# 项目中最大的挑战及你认为的亮点

## 最大的挑战：gitlab构建

### 问题出现：what

推荐其他项目使用hard-source-webpack-plugin，但是偶现构建时间不减反增的情况。

首先我自己在项目中引入这个插件之前是在本地测过速的，确实提升了构建速度之后才提交代码，并且在自己的gitlab仓库的流水线构建中，也是减少构建时间也都是没有问题的。

### 问题分析：how

而引入了这个插件之后构建速度有影响的项目，经gitlab流水线日志的分析，确实是读缓存失败，导致了构建速度变慢，然后分析了他们的项目组成，他们的项目中多有个定制化的分支，分支不同由于需求的不同代码也差异较大，但是他们提交后都在同一个构建环境中进行构建，由于他们配置了并行构建模式，并且环境中有多个runner，然后我发现他们不同的分支是有可能被gitlab-runner拉到同一个文件夹下执行构建的，这样两个不同项目之间就共用了缓存，在两个项目中切换时就导致了缓存失效。而之所以会用到相同的gitlab-runner，是因为他们的job都配置了相同的tag，导致gitlab-runner空闲后就会拉去对应的job执行。

### 问题解决：do

于是找到了云平台组，让他们提供了不同的gitlab-runner的tag，然后在不同的分支中使用不同的tag，这样不同定制化的代码就不会被拉到同样的文件夹下进行构建，就可以准确命中缓存，提高构建速度了。

### 结尾思考：why

这个问题的主要原因就是对gitlab流水线的构建过程不清晰导致的，因为我在本地构建的时候都是同一份代码，所以构建时候都能命中缓存。但是当我们将代码提交到gitlab时，gitlab的构建是将代码按照一定的策略拉到特定的工作区进行构建，所以这就有不同代码使用同一份工作区和缓存的情况发生，而为了避免这种情况发生，我们就需要选择一定的策略将代码将不同的代码拉到不同工作区。

额外：在解决问题的过程中google时候并没有找到说gitlab构建或者这个插件有人出现过类似的问题，这也是由于我们的仓库分支比较特殊造成的所以没有遇到别人也有这个问题，我们在同一仓库下进行多个并线主线且差异很大的开发跟正常开发的仓库场景不同。

## 最大挑战：接入第三方地图

### 问题出现：

正常的地图开发都是使用的地图的标准坐标系，没有经过转换，都是地图配置好的，而有个需要要求接入现场已部署的一个非标准的只有深圳地图的坐标系的地图瓦片，并且他们地图平台提供了一个地图的JSSDK，并且给的文档也是使用那个SDK进行开发。而我们项目中地图是使用leaflet并且已经在上面进行了一些业务的开发了，如果替换别的地图组件，对原有业务有较大影响。我们希望不通过引入他们的SDK而直接直接使用他们提供的地图

### 问题分析：

通过调试他们的SDK，通过返回值得出了地图坐标系的一些基础信息，并且通过请求瓦片的图的url得出url的使用格式。

### 问题解决：

通过坐标系的基础信息，并通过查阅坐标系的转换方式，编写了一个自定义坐标写，通过修改默认的坐标系，成功使用了他们的地图瓦片。

### 结尾思考：

根据业务需求，学习涉及到的地图知识，并推动业务。

## 项目难点：

主要是：前端大量数据处理、渲染问题。

- 将计算耗时CPU密集的操作交给web worker，如将文件的MD5交给web worker执行，避免产生卡顿。
- 能分页的数据都分页处理，无法分页或者需求要求不能分页的引用长列表，现在antd的Tree支持长列表了，不支持的部分我们使用React-virtualized实现。
- 多层级可以异步加载的适用异步加载，在展开的时候去请求对应的数据
- 请求优化，对于长时间不变的大数据通过在前端增加缓存减少请求时间。请求后可以复用的数据存储在Redux中。
- 图片都适用懒加载，对于不在视口中的图片暂不显示，等进入视口后再加载

从请求、JS处理、DOM节点渲染3个方面优化



