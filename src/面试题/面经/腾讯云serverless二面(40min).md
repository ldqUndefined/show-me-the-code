# 腾讯云serverless二面(40min)

叫我讲了一下项目业务，说我做的东西太简单了，问了我日均访问量，我说是toG项目访问量很小。。。。(听我说完业务流程之后说项目中难点在后端，你前端也没有涉及到，这个我也不知道怎么回答。。。)

项目写了使用长列表优化渲染，面试官说我就相当于对请求的返回值的字段进行了筛选减少了网络请求的体积，然后用了别人库做长列表优化没有什么难点（我愣住了也确实。。。这个不知道怎么回答）

讲了下项目中怎么定位到性能问题的，我说通过chrome控制面板的火焰图看到一个函数执行过程中频繁触发垃圾回收，他问：火焰图观察得到垃圾回收吗？答：看得到

问了V8的垃圾回收机制，答：分为新生代和老生代，新生代分为对象区和空闲区，触发新生代垃圾回收时，会从根变量开始遍历，把引用到的对象标记为活动对象，没引用到的就是垃圾数据，然后将活动变量拷贝到空闲区前面按顺序摆放，并交换对象区和空闲区的指针。而对于老生代如果分为两个区就太浪费内存了并且拷贝也浪费较多时间，然后讲了标记-清理，讲活动对象留着，标记为垃圾的清除，但是这样会有很多垃圾碎片，所以又使用了标记-整理，将对象按顺序整理到内存前面，减少了内存碎片，但是对于大量垃圾回收时会导致卡顿，所以V8使用了增量垃圾清理的方式，将垃圾标记、垃圾清理拆分成很多个小任务，交替在JS的执行过程中，减少了卡顿。问：新生代的对象怎么晋升到老生代？答：两次新生代垃圾回收没有清理掉的就晋升。问：还有呢？答：如果声明一个比较大的对象也会直接到老生代中。问：还有吗？我答：暂时只知道这些。问：那node中如何设置新生代和老生代内存大小？答：对node不熟。

又问了大文件分片上传的具体实现(后端是不是我写的？不是，有没有了解过后端怎么做？我答就合并分片)。问：分片怎么传？答：用File.prototype.slice这个api。问：如果一次只能并行6个请求的话，为什么不直接切6片？答：因为体积太大重传代价高。(其实应该还应该答会阻塞别的请求，当时没想起来)

问了为什么选redux-saga，我说因为相比于redux-thunk而言提供了更多的精细化控制。

为什么选redux，我说redux是数据集中管理解决方案，约定不能直接修改数据，而是需要通过触发action的方式修改，这样数据的修改源可追溯，方便debug，他好像不满意，问还有吗？我说暂时只想到这么多。

问：项目为什么引入typescript？答：为了项目的可维护性。面试官好像不太满意，我说现在typescript是主流，引入typescript也有紧跟前端主流的目的。问：要是有人就是不写类型怎么办？答：项目开启了最严格的typescript，并且引入eslint和husky在提交之前会进行一次eslint检测，检测失败不能提交。问：要是有人就写any怎么办？答：确实有同事写any，这个也确实能通过检测，因为有些同事对typescript不熟，觉得开发过程中写类型会增加开发时间就直接any了，我只能叫同事在需求不多的时候把类型补全(感觉面试官是想我说可以通过merge request来强制同事写类型？不写的不通过？)。问：你怎么在项目中推广typescript的？答：和同事科普最基础的用法。总之在typescript引入这块面试官好像不满意，因为我没有说服他为啥引入typescript以及同事不写类型怎么解决的问题，我感觉就是提供类型可维护而且同事不写我也没办法啊。。。。

项目为什么是这样的技术选型？依据是什么？(项目是react全家桶+typescript)，我说因为全公司的技术栈都是react，所以为了同事上手快只能选React，面试官好像不满意。

问：项目中写了Nginx，这个不是后端的东西吗，为什么写在前端里？答：这个是用来做反向代理防止跨域的。问：那不应该后端做吗？答：因为请求无论跨域不跨域，后端都会返回，只不过浏览器对于跨域拦截了，跨域是浏览器的同源策略，所以我理解应该前端配，我还说另一个项目就是后端配的CORS跨域头，所以前后端都能做。问：那跨域不就是后端做的吗？而且你引入了nginx，万一他出问题了怎么办？答：我在项目中Nginx没挂过，所以没遇到过这种情况(想了一下确实Nginx有挂的可能，果然还是我前端的访问量太小了没遇到过这种情况啊)

问：看你说自己熟悉React，讲讲fiber和fiber之前有什么不同。答：fiber之前是递归的diff，所以在diff的过程中不能停止，如果计算量大的话，会占用js过长时间导致卡顿，fiber通过将之前的树形结构改造成链表的形式，以fiber的node节点为工作单位，并使用requestIdleCallback这个api，每次完成一个节点都会去看还剩余多少时间，如果剩余时间不足就交还执行权，等空闲时候再继续执行，将diff的过程拆成异步可中断的任务，避免了卡顿。问：你说到requestIdleCallback这个api，这个api的执行时机是？我说在页面渲染之后。问：具体是指？我说浏览器将任务执行完后会执行requestAnimationCallback，然后执行渲染layout，渲染完后空闲了调用requestIdleCallback，如果前面的任务没有修改样式之类的，layout不一定会触发。问：所以你觉得requestIdleCallback是在UI渲染之后执行是吗？答：是的

问你觉得自己这个年限(1.5年)投腾讯，自己有什么优势吗？我说我善于沟通以及比较热爱学习，这也是我为什么当项目前端小组长的原因，他好像不觉得这个是优势(好像确实。。。。哪有程序员不热爱学习追求技术的？好难答)，然后说了自己大学时秋招投过腾讯，没过然后对腾讯比较向往，他说你投递记录里你以前投的是移动端，我愣了下因为我忘了投的啥，然后我说我大学时候还分不清客户端和前端。

问：那你怎么体现自己热爱学习呢，我举了个同事在项目中使用事件原生绑定和react事件绑定导致的问题，对于事件触发的顺序无法定位的场景，我说通过查阅资料了解了React的事件机制，知道了原生事件先于React事件触发，(可能我没表达好讲得有点久)，面试官说我大概知道你意思了。

问：有用过node吗？答：在项目中都是负责前端的模块，基本没有接触node。

面试官：今天大概就到这里了，你有什么想问的吗？我问这个岗位对node掌握的要求很高吗？他说也不是对node掌握要求高，大概意思就是现在前端不会node有点说不过去（小公司没有用node的契机，真的是硬伤啊）。我说我觉得自己JS基础不错，学习起来也不会太久，他问那如果让你学node你会怎么学呢？我说官网过一遍，express和koa的demo过一遍再在社区和github上找一些最佳实践之类的动手做做，他说那就是带着目的学习是吗？我说是的。

然后就结束面试了，这个应该是部门leader吧，对人选以前的项目要求比较高，对人选的要求也比较严格，面完感觉凉凉，确实很多项目相关或者选型相关的答得面试官很明显不满意。



