# 腾讯IEG一面(60min)

讲一下ES6的let和const？let和const有块级作用域，并且不存在变量提升机，声明之前使用会报错，var有变量提升，可以在声明前使用，const不能修改值的指向。(紧张了，暂时性死区和不允许重复声明没答，就是说在块级作用域中存在let命令，他声明的变量就“绑定”在这个区域了，不再受外部影响，虽然块级作用域外可能有同名的变量，但是在声明前使用就会报错。let和const不允许在相同作用域下重复声明同一个变量，否则会报错，即使另一个变量是var声明的也不行)

怎么进行this绑定？apply、bind、call。bind是怎么实现的？我说bind是通过隐式绑定实现的，通过在特定的对象上添加一个方法，然后让这个对象调用这个方法，this就隐式地绑定到对象上了。（我理解this指向函数执行时的上下文，如果在一个对象上调用，那么就指向这个对象，不知道这样答对不对）

ES6的类的继承？如果我声明了A继承B，那B的实例的原型链是怎样的？

```
A的实例a.__proto__ === A.prototype
A.prototype.__proto__ === B.prototype。
```

ES6的Map的实现原理？数组和链表组成的数据结构，通过哈希值计算出数组下标，然后到下标对应的链表中查找。时间复杂度？O(1)

JS中以前有用对象也可以实现类似的功能，为什么要增加Map呢？对象的键名只支持字符串，当使用数字时会转成字符串，当使用引用类型时会调用对应的引用类型的原型链上的toString方法，比如用一个对象做键的话最终键名是'[Object object]'

ES6加了Promise，为什么要引入Promise？ES6之前通过回调进行异步处理，会有回调地狱产生，使用Promise可以优化异步代码的编写。还有啥写异步代码的方式？我说了自己在项目中基本都是使用async await编写异步代码，可以让我同过同步的方式编写异步代码。还有呢？还有generator，其实async await就是promise+generator的语法糖。还有呢？我说暂时就想到这些。（难道是要我回答setTimeout和setInterval？我理解这些宿主环境提供的异步，不是JS提供的异步）

HTTP报文组成形式？请求行，请求头，请求体。请求行有啥？http版本，资源的uri，请求方法。请求一定会有content-length吗？定长请求都会有content-length，接收端通过content-length进行截断。不定长请求通过transfer-encoding:chunked然后加上一个截断符号，后端通过判断截断符号决定报文结尾在哪，当时说忘了截断符是boundary还是trail了（面完之后查资料：transfer-encoding:chunked的时候，不发送content-length，在每一个分块的开头需要添加当前分块的长度，以十六进制的形式表示，后面紧跟这'\r\n'，之后是分块本身，后面也是'\r\n'，终止块是一个常规的分块，不同之处在于其长度为0，终止块后面是一个trailer，由一系列的实体消息首部构成。分块编码的应用场景：要传输大量的数据，但是在请求在没有被处理完之前响应的长度是无法获得的。）

讲一讲跨域，怎么防止跨域？反向代理和CORS头。

浏览器是怎么判断跨域的？通过判断自己源和请求的uri是否同源。

服务端怎么判断请求跨域的？当时说的是忘了是host还是origin中的哪个（面完之后查阅资料发现是host）

跨域要怎么带cookie？前端ajax要设置withCredentials，后端要设置Access-Control-Allow-Credentials为true，且在Access-Control-Allow-Origin为通配符'*'的情况下只能设置cookie:secure开启https才能携带cookie。

讲讲CSRF？讲了CSRF是基于我们已经登陆了一个平台的情况下，攻击者构造我们对一个平台的请求会带上身份认证得原理从而达到目的。那我CSRF攻击请求的是前端的域名还是后端的域名？如果前后端是通过反向代理的形式的话，就是请求的是前端的域名，如果前后端是通过CORS头的话，就是请求的后端的域名。有哪些防范？讲了下cookie的sameSite，新版本的lax默认值只有在a链接和get表单的跨域请求中会携带cookie，以及对一些比较重要的接口用验证码。验证码是怎么返回给前端的？讲了如果是服务端渲染的话，会在请求页面的时候带上图片，后端存一份验证码的信息，然后前端表单的时候带上验证码，如果是前端单页面应用的话，就发一个请求让后端你生成一个验证码存起来并返回一张图片，然后前端表单的时候带上验证码验证。

对typescript使用程度？在项目中使用一些工具类型等进行类型声明。

讲一下React是怎么知道要修改页面哪些部分的？我将了React在触发setState等方法后会进入调和过程，找出state及props变化的组件执行render后返回的JSX对象和现有的Fiber Node进行对比，从而知道哪些DOM节点需要新增、修改、删除等。（感觉没讲好）

讲一下虚拟dom？我说现在16版本的React重构成了React Fiber的形式，对于render方法返回的JSX对象，会一一对应生成对应的Fiber节点，然后在每次调和的过程中判断新的JSX对象和对应的Fiber之间的区别，然后判断修改哪些部分。

可以着重讲一下diff过程吗？讲了一下diff通过对统计元素进行diff，如果DOM节点跨越层级，那React不会尝试复用，会重新生成新的节点并删除旧的，如果两个前后节点的类型发生了变化，React也会销毁原来的，重新创建新的，对于有key的，会遍历找出可以复用的，然后进行更新，或者无法复用的就进行插入或删除。

那React的diff算法的核心是什么呢？我说就是跨层级不复用，以及不同类型不复用，因为遍历整棵树的时间复杂度太高了。（感觉这块没答好，回答得好乱，面试官不太满意，还有可以通过key告诉React哪些子元素在渲染之间是否保持稳定等）

做过难的工作内容？将了将前端项目接进公司容器云管理平台，了解了docker等知识的过程。

你说的这些是和项目部署相关的，那写代码相关的呢？讲了大文件分片上传。文件上传HTTP不是支持文件上传吗，有个content-range，为什么你要自己实现一个呢？我说我对这个头的理解是下载的时候可以条件分片下载文件的对应字节流，通过If-Range来判断之前下载过哪些部分，没有调研到上传的部分(我真的不知道可不可以上传)，然后面试官叫我讲一下分片上传的设计。

项目中浏览器性能优化？讲了数据量较大情况下使用长列表、构建gzip压缩减小资源体积、应用中图片很多用了图片懒加载等。

手写二叉搜索树，用ES6语法，只写了插入和查找的方法。最差情况下查找时间复杂度？退化成链表形式，O(n)。如何优化？在插入的过程中进行子树高度的判断，进行适当的旋转。

今天到这，有什么要问我的吗？了解了下是做一个微服务平台及一些K8S调度的？要求最好会go和node，果然大厂前端都要求会一些工具语言写一些脚本工具。问了下项目难点，说是需要很好地理解后台业务才能正确理解前端开发工作以及有很多大数据渲染场景。