# 前端页面性能优化总结

## React开发上

- 使用shouldComponentUpdate和React.memo等减少组件不必要的渲染
- 传递给子组件的函数不要用箭头函数表达式的方式，应该使用useCallback方法包裹避免子组件不必要的渲染，类组件可以通过传递类的实例方法。
- 对于计算量大的组件，可以通过useMemo进行包裹，避免不必要的重复计算。对于传递给子组件的对象值，不要使用对象字面量的形式传递，否则每次父组件渲染都会导致子组件渲染。
- 不要在同步的声明周期中执行一些计算量大的操作如ComponentDidMount、ComponentDidUpdate和useLayoutEffect等。
- 使用Context时，传递给Context.Provider的值不要传递对象字面量的形式，如果是类组件尽量传递this.state，如果是函数组件用useMemo进行包裹。对于Context.Povider的设计应该抽离出一个专门的组件，将子组件通过props.children的方法传入，这样可以避免子组件不必要的渲染。对于contenxt上有多个值得，可以合理拆分为多个contenxt，否则容易出现订阅的组件中由于自己没有订阅特定的值但还是发生不必要的渲染的情况。
- 合理使用React的异步加载React.lazy，一般以路由为基本单位进行拆分，在加载到对应的页面是才加载对应的JS文件，减少初始加载包的体积。
- 对于一些用得很少，但是体积又较大的功能，也可以使用动态import的方式，在使用的时候才去动态加载，减少初始加载包的体积。
- 对于一些跨组件跨模块或全局会使用到的数据，在请求到后放到redux上进行存储，避免重复请求冗余数据。

## Webpack打包

- 打包构建时对JS、CSS、HTML等静态资源进行压缩，减小静态资源的体积。
- 使用compress-webpack-plugin在构建时生成对应的.gz文件，并在nginx中配置gzip压缩，减少传输过程中金泰资源的体积。
- 合理配置文件指纹、配置ModuleId和NameId，尽可能减少文件指纹发生变化，在不同的构建版本中尽可能复用JS文件，增加命中缓存的次数。
- 合理使用splitChunk分包，通过webpack-bundle-analyzer分析打包后的文件大小，尽可能将包拆得小于100KB，减少首次渲染耗时及每次动态加载的耗时。
- 通过url-loader将小图片打包成base64的形式，减少图片请求次数

## 网络

- 对于JS、CSS、图片等静态资源使用cache-control开启强缓存，对html使用协商缓存，减少请求数量和请求体积。
- 在webpack中提前生成的.gz压缩文件，通过content-encoding:gzip减小请求资源的体积。
- 对于大数据量的请求，和后端协商删除不必要的字段，减少传输体积，减少请求占用的时间。
- 对于图片开启懒加载，只加载视口中的图片，避免提前加载不必要的图片资源，提升用户体验。
- 对于svg等icon类图片，可以将其修改为雪碧图的形式，将多个请求合并为一个请求。或者通过将小图片打包为base64的形式嵌入页面中，减少请求次数。



